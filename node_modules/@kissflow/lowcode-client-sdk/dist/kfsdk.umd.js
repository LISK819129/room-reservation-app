var g=(r,s,E)=>{if(!s.has(r))throw TypeError("Cannot "+E)};var a=(r,s,E)=>(g(r,s,"read from private field"),E?E.call(r):s.get(r)),d=(r,s,E)=>{if(s.has(r))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(r):s.set(r,E)},l=(r,s,E,N)=>(g(r,s,"write to private field"),N?N.call(r,E):s.set(r,E),E);var y=(r,s,E)=>(g(r,s,"access private method"),E);(function(r,s){typeof exports=="object"&&typeof module!="undefined"?module.exports=s():typeof define=="function"&&define.amd?define(s):(r=typeof globalThis!="undefined"?globalThis:r||self,r.kf=s())})(this,function(){var A,h,M,p,F;"use strict";let r=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const s={API:"API",GET_CONTEXT:"GET_CONTEXT",RETURN:"RETURN",GET_FORM_FIELD:"GET_FORM_FIELD",UPDATE_FORM:"UPDATE_FORM",GET_TABLE:"GET_TABLE",GET_TABLE_ROW:"GET_TABLE_ROW",ADD_TABLE_ROW:"ADD_TABLE_ROW",ADD_TABLE_ROWS:"ADD_TABLE_ROWS",DELETE_TABLE_ROW:"DELETE_TABLE_ROW",TO_JSON:"TO_JSON",GET_TABLE_ROWS:"GET_TABLE_ROWS",GET_SELECTED_TABLE_ROWS:"GET_SELECTED_TABLE_ROWS",MESSAGE:"MESSAGE",CONFIRM:"CONFIRM",ALERT:"ALERT",REDIRECT:"REDIRECT",OPEN_PAGE:"OPEN_PAGE",FORMAT_DATE:"FORMAT_DATE",FORMAT_DATE_TIME:"FORMAT_DATE_TIME",FORMAT_NUMBER:"FORMAT_NUMBER",FORMAT_CURRENCY:"FORMAT_CURRENCY",FORMAT_BOOLEAN:"FORMAT_BOOLEAN",GET_APP_VARIABLE:"GET_APP_VARIABLE",SET_APP_VARIABLE:"SET_APP_VARIABLE",GET_PAGE_VARIABLE:"GET_PAGE_VARIABLE",SET_PAGE_VARIABLE:"SET_PAGE_VARIABLE",GET_PAGE_PARAMS:"GET_PAGE_PARAMS",GET_ALL_PAGE_PARAMS:"GET_ALL_PAGE_PARAMS",PAGE_ON_CLOSE:"PAGE_ON_CLOSE",OPEN_POPUP:"OPEN_POPUP",GET_POPUP_PARAMS:"GET_POPUP_PARAMS",GET_ALL_POPUP_PARAMS:"GET_ALL_POPUP_PARAMS",CLOSE_POPUP:"CLOSE_POPUP",COMPONENT_GET:"COMPONENT_GET",COMPONENT_REFRESH:"COMPONENT_REFRESH",COMPONENT_SHOW:"COMPONENT_SHOW",COMPONENT_HIDE:"COMPONENT_HIDE",COMPONENT_ADD_EVENT_LISTENER:"COMPONENT_ADD_EVENT_LISTENER",CC_INITIALIZE:"CC_INITIALIZE",CC_WATCH_PARAMS:"CC_WATCH_PARAMS",WINDOW_NDEF_READER_NEW:"WINDOW_NDEF_READER_NEW",WINDOW_NDEF_READER_SCAN:"WINDOW_NDEF_READER_SCAN",WINDOW_NDEF_READER_WRITE:"WINDOW_NDEF_READER_WRITE",WINDOW_NDEF_READER_ADD_EVENT_LISTENER:"WINDOW_NDEF_READER_ADD_EVENT_LISTENER",WINDOW_NDEF_READER_MAKE_READONLY:"WINDOW_NDEF_READER_MAKE_READONLY",WINDOW_NDEF_READER_ABORT_SCAN:"WINDOW_NDEF_READER_ABORT_SCAN",DECISION_TABLE_EXECUTE:"DECISION_TABLE_EXECUTE",DATAFORM_IMPORT_CSV:"DATAFORM_IMPORT_CSV",DATAFORM_OPEN_FORM:"DATAFORM_OPEN_FORM",PROCESS_OPEN_FORM:"PROCESS_OPEN_FORM",BOARD_IMPORT_CSV:"BOARD_IMPORT_CSV",BOARD_OPEN_FORM:"BOARD_OPEN_FORM"},E={COMPONENT_ON_MOUNT:"componentOnMount",CC_ON_PARAMS_CHANGE:"onCustomComponentParamsChange"},N={POPUP_ID:"ACTIVE_POP_UP"};function C(n="lcncsdk"){return`${n}-${r()}`}const R={};function S(n,e){if(e&&Object.keys(e).length===1&&n.command!==s.API){let t=Object.values(e)[0];return t==="undefined"?void 0:t}else return e}function D(n){globalThis.parent&&globalThis.parent!==globalThis?globalThis.parent.postMessage(n,"*"):globalThis.postMessage(n)}function m(n){if(n.origin!==globalThis.location.origin){const e=n.data;if(e!=null&&e.isEvent){const{target:i,eventParams:c,eventName:T,eventConfig:P={}}=e;let o=R[i];o._dispatchEvent(T,c),P.once&&o._removeEventListener(T);return}let{_req:t,resp:_}=e;t!=null&&t._id&&R[t._id]._dispatchMessageEvents(t,_)}}globalThis.addEventListener("message",m);class G{constructor(){d(this,A,void 0);l(this,A,{})}_addEventListener(e,t){var _;a(this,A)[e]=((_=a(this,A))==null?void 0:_[e])||[],a(this,A)[e].push(t)}_removeEventListener(e,t){if(t){let _=a(this,A)[e].findIndex(t);_>-1&&a(this,A)[e].splice(_,1);return}Reflect.deleteProperty(a(this,A),e)}_dispatchEvent(e,t){return Array.isArray(a(this,A)[e])?(a(this,A)[e].forEach(_=>_(t)),!0):!1}_dispatchMessageEvents(e,t){let _=e._id;Array.isArray(a(this,A)[_])&&(a(this,A)[_].forEach(i=>{try{let c=S(e,t);i(c)}catch(c){console.error("Message callback error: ",c)}}),this._removeEventListener(_))}}A=new WeakMap;class O extends G{_postMessageAsync(e,t,_,i){return new Promise((c,T)=>{const P=C(e.toLowerCase());D({_id:P,command:e,...t}),R[P]=this,this._addEventListener(P,async o=>{(o==null?void 0:o.errorMessage)||(o==null?void 0:o.isError)?T(o):(_&&i&&(o=await i(o)),c(o))})})}_postMessage(e,t,_){const i=C(e.toLowerCase());D({_id:i,command:e,...t}),_&&this._addEventListener(t.eventName,_)}_postMessageSync(e,t){let _=0,c={_id:C(e.toLowerCase()),command:e,...t},T=new B;T.reset(),T.store(0,_),T.encodeData(1,c),D(T.sab),T.wait(0,_,1e4);let P=T.decodeData(),{_req:o,resp:k}=P,u=S(o,k);if(u!=null&&u.isError)throw new Error(`Error: ${JSON.stringify(u,null,2)}`);return u}}let I;class B{constructor(){d(this,h,void 0);d(this,M,void 0);l(this,h,new TextEncoder),l(this,M,new TextDecoder),I=I||new SharedArrayBuffer(1024*1024),this.sab=I,this.int32Array=new Int32Array(this.sab)}load(e=0){return Atomics.load(this.int32Array,e)}store(e=0,t){return Atomics.store(this.int32Array,e,t)}reset(){return this.int32Array.fill(0)}notify(e=0,t=1){return Atomics.notify(this.int32Array,e,t)}wait(e,t,_){return Atomics.wait(this.int32Array,e,t,_)}encodeData(e=0,t){const _=(T,P)=>P===void 0?"undefined":P;let i=JSON.stringify(t,_),c=a(this,h).encode(i);return this.int32Array.set(c,e),this.int32Array}decodeData(){let e=new Uint8Array(this.int32Array),t=a(this,M).decode(e).replaceAll(/\x00/g,"");return JSON.parse(t)}}h=new WeakMap,M=new WeakMap;class w extends O{showInfo(e){return super._postMessageAsync(s.MESSAGE,{message:e})}showConfirm(e){return super._postMessageAsync(s.CONFIRM,{data:{title:e.title,content:e.content,okText:e.okText||"Ok",cancelText:e.cancelText||"Cancel"}})}redirect(e){return super._postMessageAsync(s.REDIRECT,{url:e})}}class W extends O{toDate(e){return this._postMessageAsync(s.FORMAT_DATE,{date:e})}toDateTime(e){return this._postMessageAsync(s.FORMAT_DATE_TIME,{date:e})}toNumber(e){return this._postMessageAsync(s.FORMAT_NUMBER,{value:e})}toCurrency(e,t){return this._postMessageAsync(s.FORMAT_CURRENCY,{value:e,currencyCode:t})}toBoolean(e){return this._postMessageAsync(s.FORMAT_BOOLEAN,{value:e})}}class L extends O{constructor(t){super();d(this,p);this._id=t.componentId,this.type="Component",R[this._id]=this,y(this,p,F).call(this,t.componentMethods)}onMount(t){this._postMessage(s.COMPONENT_ADD_EVENT_LISTENER,{id:this._id,eventName:E.COMPONENT_ON_MOUNT,eventConfig:{once:!0}},t)}refresh(){return this._postMessageAsync(s.COMPONENT_REFRESH,{id:this._id})}show(){return this._postMessageAsync(s.COMPONENT_SHOW,{id:this._id})}hide(){return this._postMessageAsync(s.COMPONENT_HIDE,{id:this._id})}}p=new WeakSet,F=function(t){t==null||t.forEach(_=>{this[_.name]=(...i)=>{if(_.type==="method")return this._postMessageAsync(`COMPONENT_${_.name}`,{id:this._id,parameters:i});_.type==="event"&&this._postMessage(s.COMPONENT_ADD_EVENT_LISTENER,{id:this._id,eventName:_.name,eventConfig:i[1]},i[0])}})};class v extends O{constructor(e){super(),this._id=e,this.type="CustomComponent",R[this._id]=this}watchParams(e){this._postMessage(s.CC_WATCH_PARAMS,{id:this._id,eventName:E.CC_ON_PARAMS_CHANGE,eventConfig:{once:!1}},e)}}class U extends O{constructor(e){super(),this.type="Popup",this._id=e.popupId||N.POPUP_ID}getParameter(e){return this._postMessageAsync(s.GET_POPUP_PARAMS,{key:e,popupId:this._id})}getAllParameters(){return this._postMessageAsync(s.GET_ALL_POPUP_PARAMS,{popupId:this._id})}close(){return this._postMessageAsync(s.CLOSE_POPUP,{})}getComponent(e){return this._postMessageAsync(s.COMPONENT_GET,{componentId:e},!0,t=>new L(t))}}class f extends O{constructor(e,t=!1){super(),this.type="Page",this.popup=new U({}),this._id=e.pageId}getParameter(e){return this._postMessageAsync(s.GET_PAGE_PARAMS,{key:e})}getAllParameters(){return this._postMessageAsync(s.GET_ALL_PAGE_PARAMS,{pageId:this._id})}getVariable(e){return this._postMessageAsync(s.GET_PAGE_VARIABLE,{key:e})}setVariable(e,t){return this._postMessageAsync(s.SET_PAGE_VARIABLE,{key:e,value:t})}openPopup(e,t){return this._postMessageAsync(s.OPEN_POPUP,{popupId:e,popupParams:t})}getComponent(e){return this._postMessageAsync(s.COMPONENT_GET,{componentId:e},!0,t=>new L(t))}}class V extends O{constructor(e){super(),this.flowId=e}evaluate(e){return this._postMessageAsync(s.DECISION_TABLE_EXECUTE,{flowId:this.flowId,payload:e})}}class x extends O{constructor(e){super(),this._id=e}importCSV(e){return this._postMessageAsync(s.DATAFORM_IMPORT_CSV,{flowId:this._id,defaultValues:e})}openForm(e){return e._id?this._postMessageAsync(s.DATAFORM_OPEN_FORM,{flowId:this._id,itemId:e._id}):Promise.reject({message:"Instance Id (_id) is required"})}}class b extends O{constructor(e){super(),this._id=e}importCSV(e){return this._postMessageAsync(s.BOARD_IMPORT_CSV,{flowId:this._id,defaultValues:e})}openForm(e){return e._id?this._postMessageAsync(s.BOARD_OPEN_FORM,{flowId:this._id,itemId:e._id,viewId:e._view_id}):Promise.reject({message:"Instance Id (_id) is required"})}}class H extends O{constructor(e){super(),this._id=e}openForm(e){return!e._id||!e._activity_instance_id?Promise.reject({message:"Instance Id(_id) and Activity Instance Id(_activity_instance_id) are required"}):this._postMessageAsync(s.PROCESS_OPEN_FORM,{flowId:this._id,instanceId:e._id,activityInstanceId:e._activity_instance_id})}}class j extends O{constructor(e,t=!1){super(),this._id=e.appId,this.page=new f(e)}getVariable(e){return this._postMessageAsync(s.GET_APP_VARIABLE,{key:e})}setVariable(e,t){return this._postMessageAsync(s.SET_APP_VARIABLE,{key:e,value:t})}openPage(e,t){return this._postMessageAsync(s.OPEN_PAGE,{pageId:e,pageParams:t})}getDecisionTable(e){return new V(e)}getDataform(e){return new x(e)}getBoard(e){return new b(e)}getProcess(e){return new H(e)}}class K extends O{constructor(){super()}api(e,t){return this._postMessageAsync(s.API,{url:e,args:t||{}})}initialize(){return globalThis.parent&&globalThis.parent===globalThis?Promise.reject("SDK can be initialized only inside the Kissflow platform."):this._postMessageAsync(s.CC_INITIALIZE,{},!0,e=>(this.app=new j(e,!0),this.page=new f(e,!0),this.context=new v(e.componentId),this.client=new w,this.formatter=new W,this.user=e.user,this.account=e.account,this.env=e.envDetails,this))}initialise(){return this.initialize()}}var Y=new K;return Y});
